<div class="page-header">
    <h2>Nh√¢n vi√™n & L∆∞∆°ng</h2>
    <a href="/users/add" class="btn btn-primary">+ Th√™m nh√¢n vi√™n m·ªõi</a>
</div>

<div class="row">
    <div class="col-8">
        <div class="card mb-20">
            <h3>Danh s√°ch nh√¢n vi√™n</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>M√£ NV</th>
                        <th>H·ªç t√™n</th>
                        <th>S·ªë ƒëi·ªán tho·∫°i</th>
                        <th>L∆∞∆°ng c·ª©ng</th>
                        <th>M·∫≠t kh·∫©u</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each users}}
                    <tr>
                        <td>{{this.username}}</td>
                        <td>{{this.full_name}} {{#if (eq this.role 'OWNER')}}<span
                                class="badge badge-primary">Admin</span>{{/if}}</td>
                        <td>{{this.phone}}</td>
                        <td>{{formatCurrency this.default_salary}}</td>
                        <td>
                            <div class="password-field">
                                <span class="password-mask">********</span>
                                <span class="password-text" style="display: none;">{{this.plain_password}}</span>
                                <button type="button" class="btn-icon-sm toggle-password"
                                    onclick="togglePassword(this)">
                                    üëÅÔ∏è
                                </button>
                            </div>
                        </td>
                        <td>
                            <a href="/users/{{this.id}}/edit" class="btn-icon">S·ª≠a</a>
                            {{#unless (eq this.role 'OWNER')}}
                            <form action="/users/{{this.id}}?_method=DELETE" method="POST" style="display: inline;"
                                onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh√¢n vi√™n n√†y?')">
                                <button type="submit" class="btn-icon text-danger">X√≥a</button>
                            </form>
                            {{/unless}}
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>
    </div>

    <div class="col-4">
        <div class="card">
            <div class="card-header-flex">
                <h3>L·ªãch s·ª≠ tr·∫£ l∆∞∆°ng</h3>
                <a href="/users/salary-slip" class="btn btn-success btn-sm">T·∫°o phi·∫øu l∆∞∆°ng th√°ng</a>
            </div>

            <div class="salary-history-list">
                {{#each salarySlips}}
                <div class="salary-item">
                    <div class="salary-info">
                        <strong>Th√°ng {{this.month}}/{{this.year}}</strong>
                        <span class="text-muted">{{formatDateTime this.created_at}}</span>
                    </div>
                    <div class="salary-amount">
                        {{formatCurrency this.total_amount}}
                    </div>
                    <div class="salary-actions">
                        <a href="/users/salary-slips/{{this.id}}" class="btn-icon-sm">Xem</a>
                    </div>
                </div>
                {{/each}}
            </div>
        </div>
    </div>
</div>

<script>
    function togglePassword(btn) {
        const container = btn.parentElement;
        const mask = container.querySelector('.password-mask');
        const text = container.querySelector('.password-text');

        if (text.style.display === 'none') {
            text.style.display = 'inline';
            mask.style.display = 'none';
            btn.textContent = 'üîí';
        } else {
            text.style.display = 'none';
            mask.style.display = 'inline';
            btn.textContent = 'üëÅÔ∏è';
        }
    }
</script>