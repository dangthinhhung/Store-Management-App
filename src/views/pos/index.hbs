<div class="page-header">
    <h2>ƒê∆°n B√°n l·∫ª</h2>
    <a href="/pos/history" class="btn btn-secondary">üìã L·ªãch s·ª≠ b√°n l·∫ª</a>
</div>

<div class="pos-container">
    <!-- Section 1: Customer -->
    <div class="pos-section customer-section">
        <h3>1. Kh√°ch h√†ng</h3>
        <div class="form-group">
            <input type="text" id="customerSearch" class="form-control" placeholder="T√¨m kh√°ch h√†ng (SƒêT ho·∫∑c t√™n)..."
                autocomplete="off">
            <div id="customerResults" class="search-results"></div>
        </div>

        <div id="selectedCustomerDisplay" style="display:none;" class="selected-customer">
            <div class="customer-info">
                <div><strong>T√™n:</strong> <span id="customerName"></span></div>
                <div><strong>SƒêT:</strong> <span id="customerPhone"></span></div>
                <div><strong>M√£ KH:</strong> <span id="customerCode"></span></div>
            </div>
            <button type="button" class="btn-clear-customer" onclick="clearCustomer()" title="X√≥a kh√°ch h√†ng">‚úï</button>
        </div>

        <button type="button" class="btn btn-secondary btn-block mt-10" onclick="selectGuest()">Kh√°ch l·∫ª</button>
    </div>

    <!-- Section 2: Products -->
    <div class="pos-section products-section">
        <h3>2. S·∫£n ph·∫©m</h3>
        <div class="form-group">
            <input type="text" id="productSearch" class="form-control" placeholder="T√¨m s·∫£n ph·∫©m..." autocomplete="off">
        </div>

        <div id="productGrid" class="product-grid">
            {{#each products}}
            {{#if this.is_active}}
            <div class="product-card" data-id="{{this.id}}" data-code="{{this.product_code}}" data-name="{{this.name}}"
                data-price="{{this.default_selling_price}}" data-stock="{{this.stock_quantity}}"
                onclick="addToCart(this)">
                <div class="product-name">{{this.name}}</div>
                <div class="product-code">{{this.product_code}}</div>
                <div class="product-price">{{formatCurrency this.default_selling_price}}</div>
                <div class="product-stock">Kho: {{this.stock_quantity}}</div>
            </div>
            {{/if}}
            {{/each}}
        </div>
    </div>

    <!-- Section 3: Cart -->
    <div class="pos-section cart-section">
        <h3>3. Gi·ªè h√†ng</h3>
        <table class="table cart-table">
            <thead>
                <tr>
                    <th>S·∫£n ph·∫©m</th>
                    <th>Gi√°</th>
                    <th>SL</th>
                    <th>T·ªïng</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="cartBody">
                <tr>
                    <td colspan="5" class="text-center text-muted">Ch∆∞a c√≥ s·∫£n ph·∫©m</td>
                </tr>
            </tbody>
        </table>

        <div class="cart-total">
            <strong>T·ªïng ti·ªÅn h√†ng:</strong> <span id="cartTotal">0 ‚Ç´</span>
        </div>
    </div>

    <!-- Section 4: Payment -->
    <div class="pos-section payment-section">
        <h3>4. Thanh to√°n</h3>

        <div class="payment-summary">
            <div class="summary-row">
                <span>T·ªïng ti·ªÅn h√†ng:</span>
                <span id="paymentTotal">0 ‚Ç´</span>
            </div>

            <div class="form-group mt-15">
                <label>Gi·∫£m gi√°</label>
                <select id="discountType" class="form-control mb-10" onchange="onDiscountTypeChange()">
                    <option value="none">Kh√¥ng gi·∫£m</option>
                    <option value="percent">% Ph·∫ßn trƒÉm</option>
                    <option value="fixed">S·ªë ti·ªÅn (VNƒê)</option>
                </select>
                <input type="number" id="discountValue" class="form-control" placeholder="Nh·∫≠p gi√° tr·ªã..."
                    style="display:none;" oninput="calculatePayment()">
            </div>

            <div class="summary-row">
                <span>T·ªïng gi·∫£m gi√°:</span>
                <span id="discountAmount" class="text-danger">0 ‚Ç´</span>
            </div>

            <div class="summary-row total">
                <span>Kh√°ch ph·∫£i tr·∫£:</span>
                <span id="finalAmount" class="text-primary">0 ‚Ç´</span>
            </div>

            <div class="form-group mt-15">
                <label>H√¨nh th·ª©c thanh to√°n</label>
                <select id="paymentMethod" class="form-control">
                    <option value="Ti·ªÅn m·∫∑t">Ti·ªÅn m·∫∑t</option>
                    <option value="Chuy·ªÉn kho·∫£n">Chuy·ªÉn kho·∫£n</option>
                </select>
            </div>
        </div>


        <button class="btn btn-primary btn-block btn-lg mt-20" onclick="submitOrder()">THANH TO√ÅN</button>
    </div>
</div>

<!-- Success Notification -->
<div id="successNotification" class="notification success-notification" style="display: none;">
    <div class="notification-content">
        <div class="notification-icon">‚úÖ</div>
        <div class="notification-message">
            <h4 id="notificationTitle">Th√†nh c√¥ng!</h4>
            <p id="notificationMessage">Thanh to√°n ƒë∆°n h√†ng th√†nh c√¥ng</p>
        </div>
        <button class="notification-close" onclick="closeNotification()">√ó</button>
    </div>
</div>

<!-- Error Notification -->
<div id="errorNotification" class="notification error-notification" style="display: none;">
    <div class="notification-content">
        <div class="notification-icon">‚ùå</div>
        <div class="notification-message">
            <h4>L·ªói!</h4>
            <p id="errorMessage">C√≥ l·ªói x·∫£y ra</p>
        </div>
        <button class="notification-close" onclick="closeErrorNotification()">√ó</button>
    </div>
</div>

<!-- Custom Confirmation Modal -->
<div id="confirmModal" class="modal-overlay" style="display: none !important;" onclick="handleOverlayClick(event)">
    <div class="modal-container" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h3>X√°c nh·∫≠n ƒë∆°n h√†ng</h3>
            <button class="modal-close" onclick="closeConfirmModal()">√ó</button>
        </div>
        <div class="modal-body">
            <div class="confirm-section">
                <h4>Th√¥ng tin kh√°ch h√†ng</h4>
                <div class="info-row">
                    <span class="label">T√™n:</span>
                    <span class="value" id="confirmCustomerName"></span>
                </div>
                <div class="info-row">
                    <span class="label">SƒêT:</span>
                    <span class="value" id="confirmCustomerPhone"></span>
                </div>
            </div>

            <div class="confirm-section">
                <h4>S·∫£n ph·∫©m</h4>
                <table class="confirm-table">
                    <thead>
                        <tr>
                            <th>T√™n s·∫£n ph·∫©m</th>
                            <th>SL</th>
                            <th>ƒê∆°n gi√°</th>
                            <th>Th√†nh ti·ªÅn</th>
                        </tr>
                    </thead>
                    <tbody id="confirmProductList"></tbody>
                </table>
            </div>

            <div class="confirm-section">
                <h4>Thanh to√°n</h4>
                <div class="payment-details">
                    <div class="payment-row">
                        <span>T·ªïng ti·ªÅn h√†ng:</span>
                        <span id="confirmTotal"></span>
                    </div>
                    <div class="payment-row">
                        <span>Gi·∫£m gi√°:</span>
                        <span class="text-danger" id="confirmDiscount"></span>
                    </div>
                    <div class="payment-row">
                        <span>H√¨nh th·ª©c thanh to√°n:</span>
                        <span class="text-info" id="confirmPaymentMethod"></span>
                    </div>
                    <div class="payment-row total-row">
                        <span><strong>Kh√°ch ph·∫£i tr·∫£:</strong></span>
                        <span class="text-primary" id="confirmFinal"></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeConfirmModal()">H·ªßy</button>
            <button class="btn btn-primary" onclick="confirmOrderSubmit()">X√°c nh·∫≠n thanh to√°n</button>
        </div>
    </div>
</div>

<script>
    // Global state
    let selectedCustomer = null;
    let cart = [];
    let allProducts = [];

    // Initialize
    document.addEventListener('DOMContentLoaded', function () {
        // Load all products for filtering
        allProducts = Array.from(document.querySelectorAll('.product-card')).map(card => ({
            element: card,
            id: card.dataset.id,
            code: card.dataset.code,
            name: card.dataset.name,
            price: parseFloat(card.dataset.price) || 0,
            stock: parseInt(card.dataset.stock) || 0
        }));

        // Product search
        document.getElementById('productSearch').addEventListener('input', function () {
            const query = this.value.toLowerCase();
            allProducts.forEach(product => {
                const matches = product.name.toLowerCase().includes(query) ||
                    product.code.toLowerCase().includes(query);
                product.element.style.display = matches ? 'block' : 'none';
            });
        });
    });

    // Customer search
    const customerSearchInput = document.getElementById('customerSearch');
    const customerResults = document.getElementById('customerResults');

    customerSearchInput.addEventListener('input', function () {
        const query = this.value.trim();
        if (query.length < 1) {
            customerResults.innerHTML = '';
            customerResults.style.display = 'none';
            return;
        }

        // Determine if searching by phone (numeric) or name (letters)
        const isNumeric = /^[0-9]+$/.test(query);
        let searchUrl = '/customers/search?q=' + encodeURIComponent(query);

        fetch(searchUrl)
            .then(res => res.json())
            .then(customers => {
                if (customers && customers.length > 0) {
                    // Filter based on query type
                    let filtered = customers;
                    if (isNumeric) {
                        // Phone prefix search
                        filtered = customers.filter(c => c.phone && c.phone.startsWith(query));
                    }

                    if (filtered.length > 0) {
                        customerResults.innerHTML = filtered.map(c => {
                            // Safely escape customer data for onclick
                            const custData = {
                                name: c.name || '',
                                phone: c.phone || '',
                                code: c.code || ''
                            };
                            return `<div class="result-item" onclick='selectCustomerFromSearch(${JSON.stringify(JSON.stringify(custData))})'>
                                <strong>${custData.name}</strong> - ${custData.phone} ${custData.code ? '(' + custData.code + ')' : ''}
                            </div>`;
                        }).join('');
                        customerResults.style.display = 'block';
                    } else {
                        customerResults.innerHTML = '<div class="result-item text-muted">Kh√¥ng t√¨m th·∫•y</div>';
                        customerResults.style.display = 'block';
                    }
                } else {
                    customerResults.innerHTML = '<div class="result-item text-muted">Kh√¥ng t√¨m th·∫•y</div>';
                    customerResults.style.display = 'block';
                }
            })
            .catch(err => {
                console.error('Customer search error:', err);
                customerResults.style.display = 'none';
            });
    });

    function selectCustomerFromSearch(customerJson) {
        // Parse the double-encoded JSON
        const customer = JSON.parse(customerJson);
        selectedCustomer = customer;
        document.getElementById('customerName').textContent = customer.name || '';
        document.getElementById('customerPhone').textContent = customer.phone || '';
        document.getElementById('customerCode').textContent = customer.code || 'N/A';
        document.getElementById('selectedCustomerDisplay').style.display = 'flex';
        customerSearchInput.style.display = 'none';
        customerResults.style.display = 'none';
    }

    function selectGuest() {
        selectedCustomer = { name: 'Kh√°ch l·∫ª', phone: '', code: '' };
        document.getElementById('customerName').textContent = 'Kh√°ch l·∫ª';
        document.getElementById('customerPhone').textContent = 'N/A';
        document.getElementById('customerCode').textContent = 'N/A';
        document.getElementById('selectedCustomerDisplay').style.display = 'flex';
        customerSearchInput.style.display = 'none';
    }

    function clearCustomer() {
        selectedCustomer = null;
        document.getElementById('selectedCustomerDisplay').style.display = 'none';
        customerSearchInput.style.display = 'block';
        customerSearchInput.value = '';
    }

    // Add to cart
    function addToCart(cardElement) {
        const productId = cardElement.dataset.id;
        const productCode = cardElement.dataset.code;
        const productName = cardElement.dataset.name;
        const productPrice = parseFloat(cardElement.dataset.price) || 0;
        const productStock = parseInt(cardElement.dataset.stock) || 0;

        if (productStock <= 0) {
            alert('S·∫£n ph·∫©m ƒë√£ h·∫øt h√†ng!');
            return;
        }

        const existingItem = cart.find(item => item.code === productCode);
        if (existingItem) {
            if (existingItem.quantity >= productStock) {
                alert('Kh√¥ng ƒë·ªß h√†ng trong kho! T·ªìn kho: ' + productStock);
                return;
            }
            existingItem.quantity++;
        } else {
            cart.push({
                id: productId,
                code: productCode,
                name: productName,
                price: productPrice,
                stock: productStock,
                quantity: 1
            });
        }

        renderCart();
    }

    function renderCart() {
        const cartBody = document.getElementById('cartBody');

        if (cart.length === 0) {
            cartBody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">Ch∆∞a c√≥ s·∫£n ph·∫©m</td></tr>';
            updateTotals();
            return;
        }

        cartBody.innerHTML = cart.map((item, index) => `
        <tr>
            <td><strong>${item.name}</strong><br><small>${item.code}</small></td>
            <td>${formatMoney(item.price)}</td>
            <td>
                <input type="number" class="form-control qty-input" 
                       value="${item.quantity}" min="1" max="${item.stock}"
                       onchange="updateQuantity(${index}, this.value, ${item.stock})">
            </td>
            <td>${formatMoney(item.price * item.quantity)}</td>
            <td><button class="btn-remove" onclick="removeFromCart(${index})">√ó</button></td>
        </tr>
    `).join('');

        updateTotals();
    }

    function updateQuantity(index, newQty, maxStock) {
        const qty = parseInt(newQty) || 1;
        if (qty < 1) {
            cart[index].quantity = 1;
        } else if (qty > maxStock) {
            alert('Kh√¥ng ƒë·ªß h√†ng! T·ªìn kho: ' + maxStock);
            cart[index].quantity = maxStock;
        } else {
            cart[index].quantity = qty;
        }
        renderCart();
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        renderCart();
    }

    function updateTotals() {
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        document.getElementById('cartTotal').textContent = formatMoney(total);
        document.getElementById('paymentTotal').textContent = formatMoney(total);
        calculatePayment();
    }

    function onDiscountTypeChange() {
        const discountType = document.getElementById('discountType').value;
        const discountInput = document.getElementById('discountValue');

        if (discountType === 'none') {
            discountInput.style.display = 'none';
            discountInput.value = '';
        } else {
            discountInput.style.display = 'block';
        }

        calculatePayment();
    }

    function calculatePayment() {
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const discountType = document.getElementById('discountType').value;
        const discountValue = parseFloat(document.getElementById('discountValue').value) || 0;

        let discountAmount = 0;
        if (discountType === 'percent') {
            discountAmount = total * (discountValue / 100);
        } else if (discountType === 'fixed') {
            discountAmount = discountValue;
        }

        const finalAmount = Math.max(0, total - discountAmount);

        document.getElementById('discountAmount').textContent = formatMoney(discountAmount);
        document.getElementById('finalAmount').textContent = formatMoney(finalAmount);
    }

    function submitOrder() {
        if (!selectedCustomer) {
            alert('Vui l√≤ng ch·ªçn kh√°ch h√†ng!');
            return;
        }

        if (cart.length === 0) {
            alert('Gi·ªè h√†ng tr·ªëng!');
            return;
        }

        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const discountType = document.getElementById('discountType').value;
        const discountValue = parseFloat(document.getElementById('discountValue').value) || 0;

        let discountAmount = 0;
        if (discountType === 'percent') {
            discountAmount = total * (discountValue / 100);
        } else if (discountType === 'fixed') {
            discountAmount = discountValue;
        }

        const finalAmount = total - discountAmount;

        // Show custom confirmation modal
        showConfirmModal(total, discountAmount, finalAmount);
    }

    function showConfirmModal(total, discountAmount, finalAmount) {
        // Populate customer info
        document.getElementById('confirmCustomerName').textContent = selectedCustomer.name;
        document.getElementById('confirmCustomerPhone').textContent = selectedCustomer.phone || 'N/A';

        // Populate product list
        const productList = document.getElementById('confirmProductList');
        productList.innerHTML = cart.map(item => `
            <tr>
                <td>${item.name}</td>
                <td>${item.quantity}</td>
                <td>${formatMoney(item.price)}</td>
                <td>${formatMoney(item.price * item.quantity)}</td>
            </tr>
        `).join('');

        // Populate totals
        document.getElementById('confirmTotal').textContent = formatMoney(total);
        document.getElementById('confirmDiscount').textContent = formatMoney(discountAmount);
        document.getElementById('confirmFinal').textContent = formatMoney(finalAmount);

        // Payment method
        const paymentMethodText = document.getElementById('paymentMethod').value === 'Ti·ªÅn m·∫∑t' ? 'üíµ Ti·ªÅn m·∫∑t' : 'üí≥ Chuy·ªÉn kho·∫£n';
        document.getElementById('confirmPaymentMethod').textContent = paymentMethodText;

        // Show modal
        const modal = document.getElementById('confirmModal');
        modal.style.setProperty('display', 'flex', 'important');
    }

    function closeConfirmModal() {
        const modal = document.getElementById('confirmModal');
        modal.style.display = 'none';
        modal.style.setProperty('display', 'none', 'important');
    }

    function handleOverlayClick(event) {
        // Close modal when clicking outside (on the overlay)
        closeConfirmModal();
    }

    function confirmOrderSubmit() {
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const discountType = document.getElementById('discountType').value;
        const discountValue = parseFloat(document.getElementById('discountValue').value) || 0;

        let discountAmount = 0;
        if (discountType === 'percent') {
            discountAmount = total * (discountValue / 100);
        } else if (discountType === 'fixed') {
            discountAmount = discountValue;
        }

        // Close modal
        closeConfirmModal();

        // Prepare data as JSON
        const orderData = {
            customer_phone: selectedCustomer.phone || '',
            discount: discountAmount,
            payment_method: document.getElementById('paymentMethod').value,
            product_code: cart.map(item => item.code),
            quantity: cart.map(item => item.quantity),
            price: cart.map(item => item.price)
        };

        fetch('/pos', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(orderData)
        })
            .then(res => {
                // Check if response is ok first
                if (!res.ok) {
                    return res.text().then(text => {
                        throw new Error(text || 'L·ªói server');
                    });
                }
                return res.json();
            })
            .then(data => {
                if (data.error) {
                    showError(data.error);
                } else {
                    showNotification('Thanh to√°n th√†nh c√¥ng!', 'ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c t·∫°o');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                }
            })
            .catch(err => {
                console.error('Submit error:', err);
                showError(err.message);
            });
    }

    function formatMoney(amount) {
        return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount || 0);
    }

    function showNotification(title, message) {
        const notification = document.getElementById('successNotification');
        document.getElementById('notificationTitle').textContent = title;
        document.getElementById('notificationMessage').textContent = message;
        notification.style.display = 'flex';

        // Auto hide after 3 seconds
        setTimeout(() => {
            notification.style.display = 'none';
        }, 3000);
    }

    function showError(message) {
        const notification = document.getElementById('errorNotification');
        document.getElementById('errorMessage').textContent = message;
        notification.style.display = 'flex';

        // Auto hide after 4 seconds
        setTimeout(() => {
            notification.style.display = 'none';
        }, 4000);
    }

    function closeNotification() {
        document.getElementById('successNotification').style.display = 'none';
    }

    function closeErrorNotification() {
        document.getElementById('errorNotification').style.display = 'none';
    }
</script>

<style>
    .pos-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto auto;
        gap: 20px;
    }

    .pos-section {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .pos-section h3 {
        margin: 0 0 15px 0;
        padding-bottom: 10px;
        border-bottom: 2px solid #e2e8f0;
        font-size: 16px;
    }

    /* Customer Section */
    .customer-section {
        grid-column: 1;
        grid-row: 1;
    }

    .selected-customer {
        background: #dcfce7;
        padding: 12px;
        border-radius: 4px;
        margin-top: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .customer-info div {
        margin-bottom: 5px;
        font-size: 13px;
    }

    .btn-clear-customer {
        background: #dc2626;
        color: white;
        border: none;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 18px;
        line-height: 1;
        padding: 0;
        flex-shrink: 0;
        margin-left: 10px;
    }

    .btn-clear-customer:hover {
        background: #991b1b;
    }

    .search-results {
        position: absolute;
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 100;
        width: calc(100% - 40px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: none;
    }

    .result-item {
        padding: 10px;
        cursor: pointer;
        border-bottom: 1px solid #f1f5f9;
    }

    .result-item:hover {
        background: #f8fafc;
    }

    /* Products Section */
    .products-section {
        grid-column: 2;
        grid-row: 1 / 3;
        max-height: 600px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    .product-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        overflow-y: auto;
        flex: 1;
        padding-right: 5px;
    }

    .product-card {
        padding: 8px;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
        cursor: pointer;
    }

    .product-card:hover {
        border-color: var(--primary-color);
    }

    .product-name {
        font-weight: 600;
        margin-bottom: 3px;
        font-size: 13px;
        line-height: 1.2;
    }

    .product-code {
        font-size: 10px;
        color: #64748b;
        margin-bottom: 4px;
    }

    .product-price {
        color: var(--primary-color);
        font-weight: 600;
        font-size: 13px;
    }

    .product-stock {
        font-size: 11px;
        color: #059669;
        margin-top: 3px;
    }

    /* Cart Section */
    .cart-section {
        grid-column: 1;
        grid-row: 2;
    }

    .cart-table {
        font-size: 13px;
    }

    .cart-table th,
    .cart-table td {
        padding: 8px 5px;
    }

    .qty-input {
        width: 60px;
        padding: 4px;
        font-size: 13px;
    }

    .btn-remove {
        background: none;
        border: none;
        color: #dc2626;
        font-size: 20px;
        cursor: pointer;
        padding: 0 8px;
    }

    .cart-total {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        font-size: 16px;
    }

    /* Payment Section */
    .payment-section {
        grid-column: 1;
        grid-row: 3;
    }

    .payment-summary {
        margin-bottom: 20px;
    }

    .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }

    .summary-row.total {
        font-weight: bold;
        font-size: 18px;
        border-top: 2px dashed #cbd5e1;
        padding-top: 15px;
        margin-top: 15px;
    }

    .text-muted {
        color: #94a3b8;
    }

    .mt-10 {
        margin-top: 10px;
    }

    .mt-15 {
        margin-top: 15px;
    }

    .mt-20 {
        margin-top: 20px;
        justify-content: space-between;
        align-items: center;
    }

    .customer-info div {
        margin-bottom: 5px;
        font-size: 13px;
    }

    .btn-clear-customer {
        background: #dc2626;
        color: white;
        border: none;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 18px;
        line-height: 1;
        padding: 0;
        flex-shrink: 0;
        margin-left: 10px;
    }

    .btn-clear-customer:hover {
        background: #991b1b;
    }

    .search-results {
        position: absolute;
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 100;
        width: calc(100% - 40px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: none;
    }

    .result-item {
        padding: 10px;
        cursor: pointer;
        border-bottom: 1px solid #f1f5f9;
    }

    .result-item:hover {
        background: #f8fafc;
    }

    /* Products Section */
    .products-section {
        grid-column: 2;
        grid-row: 1 / 3;
        max-height: 600px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    .product-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        overflow-y: auto;
        flex: 1;
        padding-right: 5px;
    }

    .product-card {
        padding: 8px;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
        cursor: pointer;
    }

    .product-card:hover {
        border-color: var(--primary-color);
    }

    .product-name {
        font-weight: 600;
        margin-bottom: 3px;
        font-size: 13px;
        line-height: 1.2;
    }

    .product-code {
        font-size: 10px;
        color: #64748b;
        margin-bottom: 4px;
    }

    .product-price {
        color: var(--primary-color);
        font-weight: 600;
        font-size: 13px;
    }

    .product-stock {
        font-size: 11px;
        color: #059669;
        margin-top: 3px;
    }

    /* Cart Section */
    .cart-section {
        grid-column: 1;
        grid-row: 2;
    }

    .cart-table {
        font-size: 13px;
    }

    .cart-table th,
    .cart-table td {
        padding: 8px 5px;
    }

    .qty-input {
        width: 60px;
        padding: 4px;
        font-size: 13px;
    }

    .btn-remove {
        background: none;
        border: none;
        color: #dc2626;
        font-size: 20px;
        cursor: pointer;
        padding: 0 8px;
    }

    .cart-total {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        font-size: 16px;
    }

    /* Payment Section */
    .payment-section {
        grid-column: 1;
        grid-row: 3;
    }

    .payment-summary {
        margin-bottom: 20px;
    }

    .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }

    .summary-row.total {
        font-weight: bold;
        font-size: 18px;
        border-top: 2px dashed #cbd5e1;
        padding-top: 15px;
        margin-top: 15px;
    }

    .text-muted {
        color: #94a3b8;
    }

    .mt-10 {
        margin-top: 10px;
    }

    .mt-15 {
        margin-top: 15px;
    }

    .mt-20 {
        margin-top: 20px;
    }

    .mb-10 {
        margin-bottom: 10px;
    }

    /* Modal Styles */
    .modal-overlay {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        background: rgba(0, 0, 0, 0.7) !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        z-index: 99999 !important;
        animation: fadeIn 0.2s;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .modal-container {
        background: white;
        border-radius: 12px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        animation: slideUp 0.3s;
    }

    @keyframes slideUp {
        from {
            transform: translateY(50px);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .modal-header {
        padding: 20px;
        border-bottom: 2px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-header h3 {
        margin: 0;
        color: var(--primary-color);
        font-size: 20px;
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 28px;
        color: #94a3b8;
        cursor: pointer;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
    }

    .modal-close:hover {
        background: #f1f5f9;
        color: #64748b;
    }

    .modal-body {
        padding: 20px;
    }

    .confirm-section {
        margin-bottom: 24px;
    }

    .confirm-section h4 {
        font-size: 14px;
        color: #64748b;
        margin: 0 0 12px 0;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .info-row {
        display: flex;
        padding: 8px 0;
        border-bottom: 1px solid #f1f5f9;
    }

    .info-row .label {
        width: 80px;
        color: #64748b;
        font-size: 14px;
    }

    .info-row .value {
        flex: 1;
        font-weight: 500;
        font-size: 14px;
    }

    .confirm-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }

    .confirm-table th {
        background: #f8fafc;
        padding: 10px;
        text-align: left;
        font-weight: 600;
        border-bottom: 2px solid #e2e8f0;
    }

    .confirm-table td {
        padding: 10px;
        border-bottom: 1px solid #f1f5f9;
    }

    .payment-details {
        background: #f8fafc;
        padding: 16px;
        border-radius: 8px;
    }

    .payment-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        font-size: 15px;
    }

    .payment-row.total-row {
        border-top: 2px dashed #cbd5e1;
        padding-top: 12px;
        margin-top: 8px;
        font-size: 18px;
    }

    .payment-row.total-row .text-primary {
        font-size: 20px;
        font-weight: 700;
    }

    .modal-footer {
        padding: 16px 20px;
        border-top: 2px solid #e2e8f0;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
    }

    .modal-footer .btn {
        min-width: 120px;
    }

    /* Notification Styles */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        min-width: 350px;
        max-width: 500px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border-radius: 8px;
        animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
        from {
            transform: translateX(400px);
            opacity: 0;
        }

        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    .notification-content {
        display: flex;
        align-items: center;
        padding: 16px 20px;
        background: white;
        border-radius: 8px;
        gap: 12px;
    }

    .success-notification .notification-content {
        border-left: 4px solid #10b981;
        background: #f0fdf4;
    }

    .error-notification .notification-content {
        border-left: 4px solid #ef4444;
        background: #fef2f2;
    }

    .notification-icon {
        font-size: 32px;
        line-height: 1;
    }

    .notification-message {
        flex: 1;
    }

    .notification-message h4 {
        margin: 0 0 4px 0;
        font-size: 16px;
        font-weight: 600;
    }

    .success-notification .notification-message h4 {
        color: #166534;
    }

    .error-notification .notification-message h4 {
        color: #991b1b;
    }

    .notification-message p {
        margin: 0;
        font-size: 14px;
        color: #64748b;
    }

    .notification-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #94a3b8;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        transition: all 0.2s;
    }

    .notification-close:hover {
        background: rgba(0, 0, 0, 0.05);
        color: #64748b;
    }

    .text-info {
        color: #2563eb;
        font-weight: 500;
    }
</style>