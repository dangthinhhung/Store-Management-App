<div class="page-header">
    <h2>Chi tiết đơn hàng {{order.code}}</h2>
    <a href="#" id="backButton" class="btn btn-secondary" onclick="goBack(event)">Quay lại</a>
</div>

<div class="details-container">
    <div class="info-group">
        <p><strong>Ngày bán:</strong> {{order.created_at}}</p>
        <p><strong>Khách hàng:</strong> {{#if order.customer_name}}{{order.customer_name}}{{else}}Khách lẻ{{/if}}</p>
        <p><strong>Hình thức thanh toán:</strong> {{order.payment_method}}</p>
        <p><strong>Trạng thái:</strong> <span class="badge badge-success">Đã thanh toán</span></p>
        <p><strong>Người tạo:</strong> {{order.created_by}}</p>
    </div>

    <table class="table">
        <thead>
            <tr>
                <th>Mã SP</th>
                <th>Tên sản phẩm</th>
                <th>Số lượng</th>
                <th>Đơn giá</th>
                <th>Thành tiền</th>
            </tr>
        </thead>
        <tbody>
            {{#each order.items}}
            <tr>
                <td>{{this.product_code}}</td>
                <td>{{this.product_name}}</td>
                <td>{{this.quantity}}</td>
                <td>{{formatCurrency this.price}}</td>
                <td>{{formatCurrency (multiply this.quantity this.price)}}</td>
            </tr>
            {{/each}}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="4" class="text-right"><strong>Tổng tiền hàng:</strong></td>
                <td>{{formatCurrency order.total_amount}}</td>
            </tr>
            <tr>
                <td colspan="4" class="text-right"><strong>Giảm giá:</strong></td>
                <td>{{formatCurrency order.discount}}</td>
            </tr>
            <tr>
                <td colspan="4" class="text-right"><strong>Thực thu:</strong></td>
                <td><strong>{{formatCurrency order.final_amount}}</strong></td>
            </tr>
        </tfoot>
    </table>
</div>

<style>
    .details-container {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .info-group {
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid #e2e8f0;
    }

    .info-group p {
        margin-bottom: 10px;
    }

    .text-right {
        text-align: right;
    }

    .badge-success {
        background-color: #dcfce7;
        color: #166534;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
    }

    .btn-secondary {
        background-color: var(--secondary-color);
        color: white;
        text-decoration: none;
    }
</style>

<script>
    function goBack(event) {
        event.preventDefault();
        const urlParams = new URLSearchParams(window.location.search);
        const backUrl = urlParams.get('back');
        if (backUrl) {
            window.location.href = backUrl;
        } else {
            window.location.href = '/pos/history';
        }
    }
</script>